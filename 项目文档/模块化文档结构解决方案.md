# 兔图项目模块化文档结构解决方案

**版本**: 1.1.0
**最后更新**: 2023-12-15
**维护人**: 技术架构组

## 目录

1. [问题背景](#1-问题背景)
2. [模块化文档结构设计](#2-模块化文档结构设计)
3. [共享内容模块](#3-共享内容模块)
4. [文档引用机制](#4-文档引用机制)
5. [实施步骤](#5-实施步骤)
6. [维护指南](#6-维护指南)

## 1. 问题背景

### 1.1 当前文档问题

项目文档中存在以下主要问题：

1. **内容重复**：相同的信息（如技术栈描述、目录结构、代码规范等）在多个文档中重复出现
2. **内容不一致**：重复内容在不同文档中的表述不一致，导致混淆
3. **维护困难**：当需要更新时，必须在多个地方进行修改，容易遗漏
4. **缺乏权威来源**：不清楚哪个文档是特定信息的权威来源

### 1.2 重复内容分析

主要重复内容包括：

| 重复内容 | 出现位置 |
|---------|---------|
| 技术栈描述 | 技术要求文档、总体实施方案、前端技术栈实施方案、技术架构实施方案 |
| 目录结构 | 技术要求文档、总体实施方案、新手入门指南 |
| 代码规范 | 技术要求文档、前端技术栈实施方案 |
| API响应格式 | 总体实施方案、技术架构实施方案、API文档 |

## 2. 模块化文档结构设计

### 2.1 模块化原则

1. **单一信息源**：每种信息只在一个地方定义，作为权威来源
2. **引用而非复制**：其他文档通过引用方式使用这些信息
3. **分层结构**：建立清晰的文档层次结构，明确依赖关系
4. **版本一致性**：确保所有文档引用的是同一版本的信息

### 2.2 文档层次结构

```
顶层文档（权威来源）
  ├── 项目文档结构与导航指南
  ├── 技术要求文档（技术栈、代码规范的权威来源）
  ├── 总体实施方案（系统架构的权威来源）
  │
  ├── 领域文档（引用顶层文档）
  │    ├── 前端技术栈实施方案
  │    ├── 数据模型实施方案
  │    ├── 用户管理实施方案
  │    └── ...
  │
  └── 指南和参考（引用顶层和领域文档）
       ├── 新手入门指南
       ├── API文档
       ├── 常见问题解答
       └── ...
```

## 3. 共享内容模块

### 3.1 技术栈模块

技术栈信息的权威来源是**技术要求文档**中的"技术栈规范"部分。其他文档应通过引用方式使用这些信息。

**技术栈模块内容**：
```markdown
## 技术栈规范

### 前端技术栈

- **框架**: Next.js 14+ (Pages Router)
  - **必须使用Pages Router架构**，明确禁止使用App Router
  - 选择Pages Router的原因：
    1. 项目稳定性：Pages Router是Next.js的成熟架构，有更稳定的API和更完善的生态
    2. 团队熟悉度：开发团队对Pages Router更为熟悉，可以提高开发效率
    3. 兼容性：现有代码库和第三方库与Pages Router有更好的兼容性
    4. 学习成本：避免团队成员需要学习App Router的新概念（如Server Components、Streaming等）
    5. 迁移风险：App Router仍在不断发展中，API可能发生变化，增加维护成本

- **样式方案**: Tailwind CSS
  - **明确禁止使用Ant Design组件**
  - 所有UI组件必须使用Tailwind CSS构建
  - 可以使用基于Tailwind CSS的组件库（如Headless UI、Radix UI）

- **状态管理**: Zustand
  - **明确禁止使用React Context API进行状态管理**
  - 所有全局状态必须使用Zustand管理
  - 组件内部状态使用React useState和useReducer

- **数据获取**: SWR
  - 所有客户端数据获取必须使用SWR
  - 服务端数据获取可以直接使用fetch API

### 后端技术栈

- **API框架**: Next.js Route Handlers
  - 所有API端点必须使用Next.js Route Handlers实现
  - API路由必须遵循RESTful设计原则

- **数据库ORM**: Prisma 5+
  - 所有数据库操作必须通过Prisma进行
  - 禁止直接编写SQL查询（除非有特殊性能需求并经过审核）

- **认证**: NextAuth.js v4.24.5
  - **必须使用v4.24.5版本**，不得升级或降级
  - 所有认证相关功能必须通过NextAuth.js实现

- **验证**: Zod
  - 所有API输入必须使用Zod进行验证
  - 前端表单验证也推荐使用Zod

- **图片处理**: Sharp
  - 所有服务端图片处理必须使用Sharp
```

### 3.2 目录结构模块

目录结构信息的权威来源是**技术要求文档**中的"文件组织"部分。

**目录结构模块内容**：
```markdown
## 目录结构

```
// 项目必须使用Pages Router架构（严格禁止使用App Router）
pages/                  # Next.js Pages Router页面
├── api/                # API路由处理器
│   └── v1/             # API版本控制
├── auth/               # 认证相关页面（必须使用NextAuth.js v4.24.5）
├── admin/              # 管理后台页面
└── index.tsx           # 首页
components/             # 共享组件
├── ui/                 # 基础UI组件（必须使用Tailwind CSS，严格禁止使用Ant Design）
├── forms/              # 表单相关组件
├── layout/             # 布局组件
└── [feature]/          # 按功能分组的组件
lib/                    # 共享库和工具函数
├── api/                # API客户端和工具
├── auth/               # 认证相关工具
├── db/                 # 数据库工具
└── utils/              # 通用工具函数
hooks/                  # 自定义React Hooks
types/                  # 全局类型定义
styles/                 # 全局样式（必须使用Tailwind CSS）
constants/              # 全局常量
config/                 # 应用配置
stores/                 # Zustand状态管理（严格禁止使用React Context API）
prisma/                 # Prisma模型和迁移
public/                 # 静态资源
```
```

### 3.3 API响应格式模块

API响应格式的权威来源是**API文档**中的"统一响应格式"部分。

**API响应格式模块内容**：
```markdown
## 统一响应格式

所有API响应必须遵循以下统一格式：

### 成功响应

```json
{
  "success": true,
  "data": {
    // 响应数据，根据API不同而不同
  },
  "message": "操作成功" // 可选
}
```

### 错误响应

```json
{
  "success": false,
  "error": {
    "code": "ERROR_CODE",
    "message": "错误描述信息",
    "details": {} // 可选，提供详细错误信息
  }
}
```

### 分页数据格式

```json
{
  "success": true,
  "data": {
    "items": [...], // 数据项数组
    "pagination": {
      "total": 100,   // 总数据条数
      "page": 1,      // 当前页码
      "limit": 10,    // 每页条数
      "totalPages": 10 // 总页数
    }
  }
}
```
```

## 4. 文档引用机制

### 4.1 引用方式

为了避免直接复制内容，我们采用以下引用机制：

1. **直接链接引用**：使用Markdown链接引用权威文档中的相关部分
```markdown
关于技术栈的详细信息，请参考[技术要求文档 - 技术栈规范](./技术要求文档.md#1-技术栈规范)。
```

2. **摘要引用**：提供简短摘要，并链接到详细内容
```markdown
项目使用Next.js 14+ (Pages Router)作为前端框架，严格禁止使用App Router。详细技术栈信息请参考[技术要求文档](./技术要求文档.md#1-技术栈规范)。
```

3. **引用说明**：在需要引用详细内容的地方，添加引用说明
```markdown
> **注意**：以下内容引用自[技术要求文档](./技术要求文档.md#1-技术栈规范)，如有差异，以技术要求文档为准。
```

### 4.2 版本一致性

为确保引用内容的版本一致性：

1. 在权威文档更新时，添加明确的版本号和更新日期
2. 在引用文档中指明引用的版本
3. 当权威文档更新时，检查并更新所有引用文档

## 5. 实施步骤

### 5.1 文档重构步骤

1. **识别权威来源**：
   - 技术栈规范 → 技术要求文档
   - 目录结构 → 技术要求文档
   - API响应格式 → API文档
   - 系统架构 → 总体实施方案

2. **清理重复内容**：
   - 从非权威文档中移除重复内容
   - 替换为适当的引用

3. **更新文档间链接**：
   - 添加明确的文档间引用链接
   - 确保链接指向正确的章节

4. **添加版本信息**：
   - 为所有文档添加版本号和更新日期
   - 建立版本历史记录

### 5.2 文档更新流程

1. 识别需要更新的权威文档
2. 更新权威文档内容，递增版本号
3. 识别所有引用该文档的下游文档
4. 检查并更新下游文档中的引用
5. 在版本历史中记录更新

## 6. 维护指南

### 6.1 添加新文档

添加新文档时：

1. 确定文档在层次结构中的位置
2. 识别需要引用的权威内容
3. 使用适当的引用机制
4. 添加到文档导航系统中

### 6.2 更新现有文档

更新现有文档时：

1. 检查文档是否为权威来源
   - 如果是，更新内容并递增版本号
   - 如果不是，检查是否需要更新引用

2. 如果更新权威文档：
   - 通知所有引用该文档的维护者
   - 在项目通知系统中发布更新通知

### 6.3 文档一致性检查

定期进行文档一致性检查：

1. 检查所有引用是否指向最新版本的权威文档
2. 检查是否有未使用引用机制的重复内容
3. 验证所有文档链接是否有效
4. 更新过期的引用和链接

## 版本历史

| 版本 | 日期 | 更新内容 | 更新人 |
|-----|------|---------|-------|
| 1.0.0 | 2023-11-16 | 初始版本 | 技术架构组 |
| 1.1.0 | 2023-12-15 | 实施模块化文档结构，整合重复内容 | 技术架构组 |
