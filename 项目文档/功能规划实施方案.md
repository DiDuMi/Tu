# 兔图简化版重构方案 - 功能方案文档

## 目录

1. [项目概述](#项目概述)
2. [用户管理功能](#用户管理功能)
3. [内容管理功能](#内容管理功能)
4. [用户界面设计](#用户界面设计)
5. [实施计划](#实施计划)

## 项目概述

兔图简化版重构方案旨在保留原有系统的核心功能，同时简化实现方式，提高系统的稳定性和可维护性。本方案专注于两个核心功能模块：用户管理和内容管理，确保这两个模块的功能完整、稳定和高效。

### 项目目标

1. 实现完整的用户管理功能，包括用户组权限体系、用户账号管理、用户注册流程和权限控制机制
2. 实现完整的内容管理功能，包括编辑器功能、媒体管理、标签系统和互动功能
3. 确保系统的稳定性、安全性和性能
4. 提供良好的用户体验和界面设计

## 用户管理功能

### 用户组权限体系

#### 功能描述

实现六级用户组权限体系，每个用户组拥有不同的权限级别和访问控制：

1. **游客**：
   - 可浏览公开内容
   - 可进行匿名评论和点赞
   - 无需登录即可访问

2. **注册用户**：
   - 具备游客的所有权限
   - 可以使用个人账号进行评论和点赞
   - 可以查看基础内容

3. **会员用户**：
   - 具备注册用户的所有权限
   - 可以访问会员专属内容
   - 拥有更多互动功能

4. **年会用户**：
   - 具备会员用户的所有权限
   - 可以访问高级会员专属内容
   - 拥有更多特权功能

5. **运营用户**：
   - 具备内容管理权限
   - 可以创建、编辑和发布内容
   - 可以管理评论和用户反馈

6. **管理员用户**：
   - 拥有系统的完全控制权
   - 可以管理所有用户和内容
   - 可以配置系统设置和权限

#### 权限配置

管理员可以自定义调整各用户组的权限设置，包括：

- 内容访问权限：控制用户可以访问哪些类型的内容
- 功能使用权限：控制用户可以使用哪些功能
- 操作权限：控制用户可以执行哪些操作

### 用户账号管理

#### 功能描述

1. **管理员创建用户**：
   - 管理员可以直接创建用户账号
   - 指定用户名、邮箱和初始密码
   - 分配用户组和权限

2. **批量导入用户**：
   - 支持通过CSV或Excel文件批量导入用户
   - 自动验证用户数据格式
   - 导入过程中提供错误处理和报告

3. **用户状态管理**：
   - 激活/停用用户账号
   - 重置用户密码
   - 修改用户信息和权限

### 用户注册流程

#### 功能描述

1. **自主注册**：
   - 用户填写注册表单（用户名、邮箱、密码）
   - 系统验证用户输入的有效性
   - 注册成功后，用户账号默认为待审核状态

2. **审核流程**：
   - 管理员收到新用户注册通知
   - 管理员审核用户信息
   - 审核通过后，用户状态变为激活状态
   - 系统自动发送激活通知邮件给用户

3. **首次登录**：
   - 用户使用注册邮箱和密码登录
   - 首次登录时，系统引导用户完善个人信息
   - 用户确认并接受使用条款

### 权限控制机制

#### 功能描述

1. **基于用户组的权限控制**：
   - 每个用户组拥有预定义的权限集合
   - 用户继承所属用户组的权限
   - 管理员可以调整用户组的权限设置

2. **页面级访问控制**：
   - 控制用户可以访问哪些页面
   - 对未授权访问进行拦截和重定向
   - 提供友好的权限错误提示

3. **功能级访问控制**：
   - 控制用户可以使用哪些功能
   - 根据用户权限动态显示或隐藏功能按钮
   - 在服务器端验证操作权限

4. **数据访问控制**：
   - 控制用户可以查看和操作哪些数据
   - 实现数据过滤和权限检查
   - 防止未授权的数据访问

## 内容管理功能

### 编辑器功能

#### 功能描述

1. **TinyMCE编辑器集成**：
   - 完整移植当前项目的TinyMCE编辑器功能
   - 确保编辑器界面为中文
   - 支持基本的文本格式化功能（粗体、斜体、列表等）

2. **预设文案模板**：
   - 提供常用的文案模板
   - 用户可以选择模板快速创建内容
   - 支持模板的自定义和管理

3. **推荐模板功能**：
   - 系统推荐适合当前内容的模板
   - 基于内容类型和用户历史使用习惯推荐
   - 提供模板预览和应用功能

### 媒体管理

#### 功能描述

1. **本地媒体支持**：
   - 支持上传和管理本地图片和视频
   - 提供媒体库功能，方便重复使用媒体资源
   - 支持媒体文件的预览和编辑

2. **云媒体支持**：
   - 支持Google Drive、pCloud、MEGA等云存储服务
   - 允许通过链接嵌入云存储媒体
   - 自动处理云媒体链接，确保正确显示

3. **媒体排序功能**：
   - 支持拖拽排序媒体元素
   - 保留现有的媒体排序功能
   - 确保排序后云媒体正常显示

4. **媒体处理优化**：
   - 优化媒体处理流程，提高性能
   - 确保云媒体在各种情况下都能正常显示
   - 提供媒体处理错误的恢复机制

### 标签系统

#### 功能描述

1. **标题标签功能**：
   - 使用#标记关键词，提取为标签
   - 标签不显示在发布页面标题中
   - 支持多个标签的提取和管理

2. **标签显示**：
   - 在分享页面底部显示标签气泡
   - 显示标签使用数量（使用K表示千，如1000+显示为1K+）
   - 标签按使用频率或字母顺序排序

3. **标签检索**：
   - 支持点击标签进行相关内容检索
   - 提供标签云和标签列表视图
   - 支持标签的组合检索

### 互动功能

#### 功能描述

1. **评论功能**：
   - 支持游客匿名评论
   - 匿名评论可选填昵称和邮箱
   - 评论需要管理员审核后显示
   - 支持评论的回复和管理

2. **点赞功能**：
   - 支持登录用户点赞
   - 支持游客点赞（基于IP地址）
   - 显示内容的点赞数量
   - 防止重复点赞

3. **互动数据统计**：
   - 统计内容的评论数和点赞数
   - 提供互动数据的可视化展示
   - 支持按互动数据排序内容

## 用户界面设计

### 管理后台界面

#### 用户管理界面

1. **用户列表**：
   - 显示所有用户的基本信息
   - 支持按用户名、邮箱、角色等筛选
   - 提供用户状态的可视化指示

2. **用户详情**：
   - 显示用户的详细信息
   - 提供用户权限和状态的管理选项
   - 显示用户的活动历史

3. **用户组管理**：
   - 显示所有用户组及其权限设置
   - 支持创建、编辑和删除用户组
   - 提供权限配置的可视化界面

#### 内容管理界面

1. **内容列表**：
   - 显示所有内容的基本信息
   - 支持按标题、作者、分类等筛选
   - 提供内容状态的可视化指示

2. **内容编辑器**：
   - 集成TinyMCE编辑器
   - 提供媒体管理和排序功能
   - 支持标签提取和管理

3. **评论管理**：
   - 显示所有评论及其状态
   - 支持评论的审核和管理
   - 提供评论筛选和搜索功能

### 前台界面

#### 内容展示界面

1. **内容页面**：
   - 清晰展示内容标题和正文
   - 显示作者信息和发布时间
   - 底部显示标签和互动选项

2. **标签页面**：
   - 显示标签云或标签列表
   - 提供标签使用频率的可视化展示
   - 支持标签的搜索和筛选

3. **评论区**：
   - 显示已审核的评论
   - 提供评论表单（支持匿名评论）
   - 显示评论数量和最新评论

## 实施计划

### 阶段一：基础架构搭建

1. 搭建Next.js项目框架
2. 配置Prisma ORM和数据库连接
3. 实现用户认证和权限控制基础功能
4. 搭建基本的前端界面框架

### 阶段二：用户管理功能实现

1. 实现用户模型和数据库结构
2. 开发用户注册、登录和认证功能
3. 实现用户组和权限管理功能
4. 开发用户管理界面

### 阶段三：内容管理功能实现

1. 实现内容模型和数据库结构
2. 集成TinyMCE编辑器
3. 开发媒体管理和排序功能
4. 实现标签系统和互动功能

### 阶段四：测试和优化

1. 进行功能测试和bug修复
2. 优化系统性能和用户体验
3. 进行安全测试和加固
4. 完善文档和使用说明

### 阶段五：部署和上线

1. 准备生产环境
2. 部署应用和数据库
3. 进行最终测试和验收
4. 正式上线并监控系统运行状态
